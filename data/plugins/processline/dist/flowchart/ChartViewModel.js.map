{"version":3,"sources":["../../src/flowchart/ChartViewModel.js"],"names":["NodeViewModel","ChartViewModel","chartViewModel","data","nodeviewmodel","nodes","createNodesViewModel","nodeID","i","length","node","id","Error","connectorIndex","findNode","Data","nodeDataModel","push","select","deselect","deltaX","deltaY","selectedNodes","getSelectedNodes","x","y","ctrlKey","toggleSelected","deselectAll","nodeIndex","indexOf","splice","newNodeViewModels","newNodeDataModels","deletedNodeIds","selected","selectionRect","width","height"],"mappings":"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","file":"ChartViewModel.js","sourcesContent":["import {NodeViewModel} from './NodeViewModel';\n\n\n export class ChartViewModel{\n         constructor(chartViewModel){\n           this.data=chartViewModel;\n           this.nodeviewmodel=new NodeViewModel(this.data.nodes);\n           this.nodes = this.nodeviewmodel.createNodesViewModel(this.data.nodes);\n           //this.nodes=this.data.nodes;\n\n         }\n\n\t\t//\n\t\t// Find a specific node within the chart.\n\t\t//\n\t\tfindNode(nodeID) {\n\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\n\t\t\t\tvar node = this.nodes[i];\n\t\t\t\tif (node.data.id == nodeID) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new Error(\"Failed to find node \" + nodeID);\n\t\t};\n\n\t\t//\n\t\t// Find a specific input connector within the chart.\n\t\t//\n\t\tfindInputConnector(nodeID, connectorIndex) {\n\n\t\t\tvar node = this.findNode(nodeID);\n\n\t\t\tif (!node.Data || node.Data.length <= connectorIndex) {\n\t\t\t\tthrow new Error(\"Node \" + nodeID + \" has invalid input connectors.\");\n\t\t\t}\n\n\t\t\treturn node.Data[connectorIndex];\n\t\t};\n\n\n\t\t// Add a node to the view model.\n\t\t//\n\t\taddNode(nodeDataModel) {\n\t\t\tif (!this.data.nodes) {\n\t\t\t\tthis.data.nodes = [];\n\t\t\t}\n\n\t\t\t//\n\t\t\t// Update the data model.\n\t\t\t//\n\t\t\tthis.data.nodes.push(nodeDataModel);\n\n\t\t\t//\n\t\t\t// Update the view model.\n\t\t\t//\n\t\t\t//this.nodes.push(new NodeViewModel(nodeDataModel));\n\t\t}\n\n\t\t//\n\t\t// Select all nodes and connections in the chart.\n\t\t//\n\t\tselectAll() {\n\n\t\t\tvar nodes = this.nodes;\n\t\t\tfor (var i = 0; i < nodes.length; ++i) {\n\t\t\t\tvar node = nodes[i];\n\t\t\t\tnode.select();\n\t\t\t}\n\n\t\t\t}\n\n\t\t//\n\t\t// Deselect all nodes and connections in the chart.\n\t\t//\n\t\tdeselectAll() {\n\n\t\t\tvar nodes = this.nodes;\n\t\t\tfor (var i = 0; i < nodes.length; ++i) {\n\t\t\t\tvar node = nodes[i];\n\t\t\t\tnode.deselect();\n\t\t\t}\n\n\n\t\t};\n\n\t\t//\n\t\t// Update the location of the node and its connectors.\n\t\t//\n\t\tupdateSelectedNodesLocation(deltaX, deltaY) {\n\n\t\t\tvar selectedNodes = this.getSelectedNodes();\n\n\t\t\tfor (var i = 0; i < selectedNodes.length; ++i) {\n\t\t\t\tvar node = selectedNodes[i];\n\t\t\t\tnode.data.x += deltaX;\n\t\t\t\tnode.data.y += deltaY;\n\t\t\t}\n\t\t};\n\n\t\t//\n\t\t// Handle mouse click on a particular node.\n\t\t//\n\t\thandleNodeClicked(node, ctrlKey) {\n\n\t\t\tif (ctrlKey) {\n\t\t\t\tnode.toggleSelected();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.deselectAll();\n\t\t\t\tnode.select();\n\t\t\t}\n\n\t\t\t// Move node to the end of the list so it is rendered after all the other.\n\t\t\t// This is the way Z-order is done in SVG.\n\n\t\t\tvar nodeIndex = this.nodes.indexOf(node);\n\t\t\tif (nodeIndex == -1) {\n\t\t\t\tthrow new Error(\"Failed to find node in view model!\");\n\t\t\t}\n\t\t\tthis.nodes.splice(nodeIndex, 1);\n\t\t\tthis.nodes.push(node);\n\t\t};\n\n\n\n\t\t//\n\t\t// Delete all nodes and connections that are selected.\n\t\t//\n\t\tdeleteSelected() {\n\n\t\t\tvar newNodeViewModels = [];\n\t\t\tvar newNodeDataModels = [];\n\n\t\t\tvar deletedNodeIds = [];\n\n\t\t\t//\n\t\t\t// Sort nodes into:\n\t\t\t//\t\tnodes to keep and\n\t\t\t//\t\tnodes to delete.\n\t\t\t//\n\n\t\t\tfor (var nodeIndex = 0; nodeIndex < this.nodes.length; ++nodeIndex) {\n\n\t\t\t\tvar node = this.nodes[nodeIndex];\n\t\t\t\tif (!node.selected()) {\n\t\t\t\t\t// Only retain non-selected nodes.\n\t\t\t\t\tnewNodeViewModels.push(node);\n\t\t\t\t\tnewNodeDataModels.push(node.data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Keep track of nodes that were deleted, so their connections can also\n\t\t\t\t\t// be deleted.\n\t\t\t\t\tdeletedNodeIds.push(node.data.id);\n\t\t\t\t}\n\t\t\t}\n\n\n\n\t\t\t//\n\t\t\t// Remove connections that are selected.\n\t\t\t// Also remove connections for nodes that have been deleted.\n\t\t\t//\n\n\n\t\t\t//\n\t\t\t// Update nodes and connections.\n\t\t\t//\n\t\t\tthis.nodes = newNodeViewModels;\n\t\t\tthis.data.nodes = newNodeDataModels;\n\n\t\t};\n\n\t\t//\n\t\t// Select nodes and connections that fall within the selection rect.\n\t\t//\n\t\tapplySelectionRect(selectionRect) {\n\n\t\t\tthis.deselectAll();\n\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\n\t\t\t\tvar node = this.nodes[i];\n\t\t\t\tif (node.x() >= selectionRect.x &&\n\t\t\t\t\tnode.y() >= selectionRect.y &&\n\t\t\t\t\tnode.x() + node.width() <= selectionRect.x + selectionRect.width &&\n\t\t\t\t\tnode.y() + node.height() <= selectionRect.y + selectionRect.height)\n\t\t\t\t{\n\t\t\t\t\t// Select nodes that are within the selection rect.\n\t\t\t\t\tnode.select();\n\t\t\t\t}\n\t\t\t}\n\n\n\n\t\t};\n\n\t\t//\n\t\t// Get the array of nodes that are currently selected.\n\t\t//\n\t\tgetSelectedNodes() {\n\t\t\tvar selectedNodes = [];\n\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\n\t\t\t\tvar node = this.nodes[i];\n\t\t\t\tif (node.selected()) {\n\t\t\t\t\tselectedNodes.push(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn selectedNodes;\n\t\t};\n\n\t\t//\n\t\t// Get the array of connections that are currently selected.\n\t\t//\n\n\n\n\t};"]}